<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dettaglio Auto</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-5xl mx-auto py-10 px-4">
    <div id="car-details" class="bg-white p-6 rounded-lg shadow-lg">
      <p class="text-center">Caricamento in corso...</p>
    </div>
  </div>

  <script>
    const SHEET_ID = '1w7cr8sSZ1E3x9ipIGq7l4XepM3c-wOlX_QiydORJvmQ'; // <-- Usa il tuo
    const SHEET_NAME = 'Drive_&_Joy_ALD'; // <-- Nome della tabella
    const API_KEY = 'AIzaSyDi_MjmzliJhkHyei52cbaIRd-ciHa_ago'; // <-- Qui la tua chiave

    // Prende lo slug dall’URL (es. ?id=audi-a3)
    const params = new URLSearchParams(window.location.search);
    const carSlug = params.get("id");

    async function loadCarDetails() {
      const container = document.getElementById("car-details");

      try {
        const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`);
        const data = await res.json();
        const headers = data.values[0];
        const rows = data.values.slice(1);

        const cars = rows.map(row => {
          let car = {};
          headers.forEach((h, i) => car[h] = row[i] || '');
          return car;
        });

        // Cerca l’auto corrispondente
        const car = cars.find(c => {
          const slug = `${c.Brand}-${c.Modello}`.toLowerCase().replace(/\s+/g, '-');
          return slug === carSlug;
        });

        if (!car) {
          container.innerHTML = "<p class='text-center text-red-600'>Auto non trovata</p>";
          return;
        }

        const img = car['Immagine Copertina'] || 'https://via.placeholder.com/800x400?text=No+Image';
        const title = `${car.Brand} ${car.Modello}`;
        const allestimento = car.Allestimento || '';
        const fuel = car.Alimentazione || 'N/A';
        const cambio = car.Cambio || 'N/A';
        const potenza = car['Potenza Massima CV'] || 'N/A';
        const posti = car.Posti || 'N/A';
        const tipo = car['Tipo Veicolo'] || 'N/A';
        const player = car['Link al player'];

        let canoniHTML = '';
        for (let i = 1; i <= 8; i++) {
          if (car[`Canone ${i}`]) {
            canoniHTML += `
              <div class="border p-4 rounded-md bg-gray-50">
                <p><strong>Canone ${i}:</strong> €${car[`Canone ${i}`]} / mese</p>
                <p>Durata: ${car[`Durata ${i}`]} mesi</p>
                <p>Km: ${car[`Km ${i}`]}</p>
                <p>Anticipo: €${car[`Anticipo ${i}`]}</p>
              </div>
            `;
          }
        }

        container.innerHTML = `
          <h1 class="text-3xl font-bold mb-4">${title}</h1>
          <img src="${img}" alt="${title}" class="w-full rounded-md mb-4"/>

          <p class="text-gray-600 mb-4">${allestimento}</p>

          <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6 text-sm">
            <div><strong>Carburante:</strong> ${fuel}</div>
            <div><strong>Cambio:</strong> ${cambio}</div>
            <div><strong>Potenza:</strong> ${potenza} CV</div>
            <div><strong>Posti:</strong> ${posti}</div>
            <div><strong>Tipo:</strong> ${tipo}</div>
          </div>

          ${player && player !== '-' ? `
            <div class="mb-6">
              <h2 class="text-xl font-bold mb-2">Video</h2>
              <iframe class="w-full aspect-video rounded-lg" src="${player}" frameborder="0" allowfullscreen></iframe>
            </div>
          ` : ''}

          <h2 class="text-xl font-bold mb-4">Opzioni di Leasing</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${canoniHTML}
          </div>
        `;
      } catch (err) {
        container.innerHTML = "<p class='text-red-600'>Errore durante il caricamento.</p>";
        console.error(err);
      }
    }

    window.addEventListener("DOMContentLoaded", loadCarDetails);
  </script>
</body>
</html>
